{% extends "base.html" %}

{% block extra_title %}
    Shopping Cart
{% endblock extra_title %}

{% block content %}

    <div class="card">
        <div class="card-body">
            <h2 class="card-title">Shopping Cart</h2>
            <div>
                {% if ticket_count == 0 %}
                    <p>
                        Empty cart
                    </p>
                    <div class="card-footer">
                        <a href="{% url "events:upcoming" %}" class="btn btn-nichetix">
                            Back to upcoming events
                        </a>
                    </div>

                {% else %}
                    <ul class="list-group">

                    {% for cart_item in cart_items %}
                        <li class="list-group item">
                            {{ cart_item.ticket_type }} ({{ cart_item.ticket_type.event.title }})
                            {{ cart_item }}
                            <div class="cart-item-control">

                                <form action="{% url "cart:update" ticket_type_id=cart_item.ticket_type_id %}"
                                      method="POST">
                                    {% csrf_token %}
                                    <label>Quantity:
                                        <input name="quantity"
                                               type="number"
                                               value="{{ cart_item.quantity }}"
                                               min="0"
                                               max="100"/>
                                        <!-- todo: Set max to amount of tickets left and check in view -->
                                    </label>
                                    <button type="submit" class="btn btn-sm btn-nichetix">
                                        Update
                                    </button>
                                </form>
                                <form action="{% url "cart:remove" ticket_type_id=cart_item.ticket_type_id %}"
                                      method="POST">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-nichetix">
                                        Remove
                                    </button>
                                </form>
                            </div>
                        </li>
                    {% endfor %}

                    <div class="card-footer">
                        <!-- todo: Checkout button doesn't update cart... formset? -->
                        <a href="{% url "events:upcoming" %}" class="btn btn-nichetix">Back</a>
                        <a href="{% url "checkout:checkout" %}" class="btn btn-nichetix">
                            Checkout
                        </a>
                    </div>

                {% endif %}
                </ul>
            </div>
        </div>
    </div>

{% endblock content %}
